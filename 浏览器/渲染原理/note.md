## 浏览器是如何渲染页面的

- 当浏览器的网络线程收到 html 文档后，会产生一个渲染任务，并将其传递给渲染主线程的消息队列
- 在事件循环机制的作用下，渲染主线程取出消息队列中的渲染任务，开启渲染流程

## 渲染流程

- 解析 html(生成两棵树)
  - DOM tree
  - CSSOM(CSS Object Model)
- 样式计算
  - 遍历得到的 DOM 树, 依次为树中的每个节点计算出它最终的样式(即 Computed Style)
  - 在这个过程中，很多预设值会变成绝对值(例如 red)，很多相对值会变成绝对值(例如 em) 
- 布局(Layout)
  - 遍历得到的 DOM 树, 计算每个节点的几何信息。例如节点的宽高、相对包含块的位置
- 分层(Layer)
  - 浏览器会对整个布局树进行分层
  - 好处在于将来某一个层改变后，仅会对该层进行处理，从而提升效率
- 绘制
  - 浏览器会为每个层单独产生指令集, 用于描述这一层的内容该如何画出来
  - 分块
    - 会将每一层分成多个小的区域
  - 光栅化
  - 画

## CSS 样式表

- style 内部样式表
- link 外部样式表
- 内联样式表
- 浏览器默认样式表(user agent stylesheet)

## 解析 HTML 中遇到 CSS 代码怎么办

- 为了提高效率，浏览器会启动一个预解析器(一个单独的线程)率先下载和解析 css，解析完成后会通知主线程合并 CSSOM
- 由于在不同的线程，所以 css 的解析不会阻塞 html 的解析

## 解析 HTML 中遇到 JS 代码怎么办

- 渲染主线程遇到 JS 时必须暂停一切行为，等待下载完毕后再继续
- 预解析线程可以分担一些下载 JS 的任务
