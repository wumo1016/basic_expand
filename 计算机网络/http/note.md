## HTTP 是什么

- 超文本传输协议
  - 超文本: 文字、图片、音频、视频等数据
  - 传输: 用来两点之间传输数据的约定和规范
  - 协议: 是一个在计算机世界里的协议, 它使用计算机能够理解的的语言确立了一种计算机之间交流通信的规范, 以及各种控制和错误处理方式

## HTTP 常见字段

- Host: 客户端发送请求时, 用来指定服务器的域名
- Content-Length: 表示本次响应的数据长度
- Content-Type: 表示本次响应的数据格式 (请求时可以通过请求头 Accept 设置可接受的数据格式)
- Content-Encoding: 表格本次响应的数据压缩方法(gzip、deflate) (请求时可以通过请求头 Accept-Encoding 设置可接受的数据格式)
- Connection: keep-alive 保持 TCP 持久连接, 以便其他请求复用(HTTP1.1 默认连接都是持久连接, 加这个字段是为了兼容老版本的 HTTP)

## 强制缓存和协商缓存

- 强缓存 (主要通过两个响应头实现 (Cache-Control 优先级更高))
  - Cache-Control
    - 相对时间(单位 s)
    - no-cache: 不缓存，但缓存中有，每次询问服务器
    - no-store: 不缓存
  - Expires: 绝对时间
- 协商缓存 (基于两种头部实现) (Etag 优先级更高)
  - 文件修改时间
    - 响应头中的 Last-Modified 表示文件最后的修改时间
    - 请求头中的 If-Modified-Since 再次发起请求的时候 带上 Last-Modified 服务器进行比对 Last-Modified 和 If-Modified-Since
      - Last-Modified > If-Modified-Since : 返回 200
      - If-Modified-Since > Last-Modified : 返回 304
  - 文件指纹
    - 响应头中的 Etag
    - 请求头中的 If-None-Match 再次发起请求的时候带上 Etag 的值 服务器进行比对 一样就返回 304 不一样就返回 200

## HTTP(1.1) 的优点

- 简单
  - http 的报文格式就是 body+header
  - 头部信息也是 key-value 的形式
- 灵活和易于扩展
  - HTTP 中的各类请求方法、url、状态码、头部段等可以自定义和扩充
- 应用广泛和跨平台
  - 从浏览器到各种 APP

## HTTP 的发展历程

- HTTP/0.9
  - 只能有 GET 请求
  - 传输数据只有纯文本格式
  - 在响应后会立即关闭连接
- HTTP/1.0
  - 引入了 HTTP Header 概念
  - 传输的数据格式不限于文本，可以包含音乐、图片等
  - 增加响应状态码、POST、HEAD 方法等
- HTTP/1.1
  - 允许持久连接
  - 增加了缓存管理(304)、Cookie 管理等
  - 增加了 PUT、DELETE 等新方法
- HTTP/2.0
  - 使用 HPACK 算法压缩头部，减少数据传输
  - 允许服务端主动向客户端推动数据
  - 多路复用
  - 必须使用 HTTPS
- HTTP/3.0
  - 基于 UDP 的 QUIC 协议

## HTTP/1.1 的特点

- 长连接
  - 早期 HTTP1.0 一个很大的问题就是，每发起一个请求，都要建立一次 TCP 连接，而且都是串行请求，做了无谓的连接建立和断开
  - HTTP1.1 默认持久连接，只要没有任意一端明确提出断开连接，则保持 TCP 连接状态(当某个长连接超过一定时间没有任何数据交互，服务端就会主动断开这个连接)
  - 默认在请求的时候 增加 connection:keep-alive (只有一次请求应答后才能复用)
- 管道网络传输
  - 可以同时发起多个请求
- 队头阻塞
  - 响应必须按顺序返回(如果前面的响应未完成，后面的则需要等待) 这称为队头阻塞
  - 所以 HTTP1.1 管道解决了请求的队头阻塞，但没有解决响应的队头阻塞
- 无状态
  - 例如需要权限的操作 每个接口都需要验证身份 它并不知道这些请求时相互关联的
  - 解决: 使用 cookie 等
- 不安全
  - 窃听风险: 通信使用明文 信息容易被窃取
  - 冒充风险: 不验证通信方的身份 因此很有可能伪装
  - 篡改风险: 无法验证报文的完整性 可能遭受篡改

## HTTP 与 HTTPS 的区别

- HTTPS 解决了 HTTP 不安全的缺陷 在 TCP 和 HTTP 网络层之间加入了 SSL/TSL 安全协议 使得报文能够加密传输
- HTTP 传输建立相对简单 在 TCP 三次握手之后即可传输数据 但 HTTPS 还需要进行 SSL/TSL 的握手过程
- HTTP 的端口是 80 HTTP 的端口是 443
- HTTPS 需要想 CA(证书权威机构)申请数字证书，来保证服务器的身份是可信的

## HTTP/2 的改进

- 头部压缩
  - 如果同时发出多个请求，他们的头是一样的或者类似的，协议会帮你消除重复的部分
  - 利用 HPACK 算法: 在客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，以后就不发送同样字段了，只发送索引号，这样就提高速度了
- 二进制格式
  - 头信息和数据体都是二进制，并且统称为帧: 头信息帧和数据帧
- 数据流
  - HTTP/2 的数据包不是按顺序发送的，每个请求或响应的数据包，都称为一个数据流，每个数据流都有一个独一无二的编号(Stream ID)
  - 客户端建立的 Stream ID 必须是奇数 服务端建立的 Stream ID 必须是偶数
- 多路复用
  - 可以在一个请求中并发多个请求或响应，而且不用一一对应
- 服务器推送
  - 服务器可以主动向客户端发送消息
